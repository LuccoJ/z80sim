                              1 ;--------------------------------------------------------
                              2 ; File Created by SDCC : FreeWare ANSI-C Compiler
                              3 ; Version 2.3.5 Fri Apr 27 12:30:19 2012
                              4 
                              5 ;--------------------------------------------------------
                              6 	.module keyboard
                              7 	.optsdcc -mz80
                              8 	
                              9 ;--------------------------------------------------------
                             10 ; Public variables in this module
                             11 ;--------------------------------------------------------
                             12 	.globl _KeyboardInited
                             13 	.globl _KeyboardPollCount
                             14 	.globl _KeyboardBufferCount
                             15 	.globl _KeyboardBuffer
                             16 	.globl _KeyTable
                             17 	.globl _SystemLock
                             18 	.globl _KeyboardInit
                             19 	.globl _PollKeyboard
                             20 	.globl _GetKeypress
                             21 ;--------------------------------------------------------
                             22 ;  ram data
                             23 ;--------------------------------------------------------
                             24 	.area _DATA
                    0000     25 G$SystemLock$0$0==.
   0000                      26 _SystemLock::
   0000                      27 	.ds 1
                    0001     28 G$KeyTable$0$0==.
   0001                      29 _KeyTable::
   0001                      30 	.ds 8
                    0009     31 G$KeyboardBuffer$0$0==.
   0009                      32 _KeyboardBuffer::
   0009                      33 	.ds 32
                    0029     34 G$KeyboardBufferCount$0$0==.
   0029                      35 _KeyboardBufferCount::
   0029                      36 	.ds 1
                    002A     37 G$KeyboardPollCount$0$0==.
   002A                      38 _KeyboardPollCount::
   002A                      39 	.ds 1
                    002B     40 G$KeyboardInited$0$0==.
   002B                      41 _KeyboardInited::
   002B                      42 	.ds 1
                             43 ;--------------------------------------------------------
                             44 ; overlayable items in  ram 
                             45 ;--------------------------------------------------------
                             46 	.area _OVERLAY
                             47 ;--------------------------------------------------------
                             48 ; external initialized ram data
                             49 ;--------------------------------------------------------
                             50 ;--------------------------------------------------------
                             51 ; global & static initialisations
                             52 ;--------------------------------------------------------
                             53 	.area _GSINIT
                             54 	.area _GSFINAL
                             55 	.area _GSINIT
                             56 ;--------------------------------------------------------
                             57 ; Home
                             58 ;--------------------------------------------------------
                             59 	.area _HOME
                             60 	.area _CODE
                             61 ;--------------------------------------------------------
                             62 ; code
                             63 ;--------------------------------------------------------
                             64 	.area _CODE
                             65 ;keyboard.c:19: bool KeyboardInited; void KeyboardInit() {
                             66 ;	genLabel
                             67 ;	genFunction
                             68 ;	---------------------------------
                             69 ; Function KeyboardInit
                             70 ; ---------------------------------
   0000                      71 _KeyboardInit_start::
   0000                      72 _KeyboardInit:
   0000 3E 03                73 	ld	a,#3
   0002 CF                   74 	rst	0x08
                             75 ;keyboard.c:20: if(!KeyboardInited) {
                             76 ;	genIfx
   0003 AF                   77 	xor	a,a
   0004 FD 21r2Bs00          78 	ld	iy,#_KeyboardInited
   0008 FD B6 00             79 	or	a,0(iy)
   000B C2r2Es00             80 	jp	nz,00103$
                             81 ;keyboard.c:21: RegisterInterrupt(PollKeyboard);
                             82 ;	genIpush
                             83 ; _saveRegsForCall: sendSetSize: 0 deInUse: 0 bcInUse: 0 deSending: 0
   000E 21r48s00             84 	ld	hl,#_PollKeyboard
   0011 E5                   85 	push	hl
                             86 ;	genCall
   0012 CDr00s00             87 	call	_RegisterInterrupt
   0015 F1                   88 	pop	af
                             89 ;keyboard.c:22: KeyboardBufferCount=0;
                             90 ;	genAssign
   0016 FD 21r29s00          91 	ld	iy,#_KeyboardBufferCount
   001A FD 36 00 00          92 	ld	0(iy),#0x00
                             93 ;keyboard.c:23: KeyboardPollCount=0;
                             94 ;	genAssign
   001E FD 21r2As00          95 	ld	iy,#_KeyboardPollCount
   0022 FD 36 00 00          96 	ld	0(iy),#0x00
                             97 ;keyboard.c:24: _SimPrintString("Keyboard initialized\n");
                             98 ;	genIpush
                             99 ; _saveRegsForCall: sendSetSize: 0 deInUse: 0 bcInUse: 0 deSending: 0
   0026 21r32s00            100 	ld	hl,#__str_0
   0029 E5                  101 	push	hl
                            102 ;	genCall
   002A CDr00s00            103 	call	__Z80SimPrintString
   002D F1                  104 	pop	af
                            105 ;	genLabel
   002E                     106 00103$:
                            107 ;	genEndFunction
   002E 3E 04               108 	ld	a,#4
   0030 CF                  109 	rst	0x08
   0031 C9                  110 	ret
   0032                     111 _KeyboardInit_end::
                    0032    112 Fkeyboard$_str_0$0$0 == .
   0032                     113 __str_0:
   0032 4B 65 79 62 6F 61   114 	.ascii "Keyboard initialized"
        72 64 20 69 6E 69
        74 69 61 6C 69 7A
        65 64
   0046 0A                  115 	.db 0x0A
   0047 00                  116 	.db 0x00
                            117 ;keyboard.c:28: void PollKeyboard() {
                            118 ;	genLabel
                            119 ;	genFunction
                            120 ;	---------------------------------
                            121 ; Function PollKeyboard
                            122 ; ---------------------------------
   0048                     123 _PollKeyboard_start::
   0048                     124 _PollKeyboard:
   0048 3E 03               125 	ld	a,#3
   004A CF                  126 	rst	0x08
                            127 ;keyboard.c:46: _endasm;
                            128 ;	genInline
                            129 ;
   004B F5                  130 		       push af
   004C C5                  131 		       push bc
   004D E5                  132 		       push hl
   004E 01 FE FE            133 		       ld bc,#0xfefe
   0051 21r01s00            134 		       ld hl,#_KeyTable
   0054                     135         KeyboardLoop:
   0054 ED 78               136 		       in a,(c)
   0056 2F                  137 		       cpl
   0057 77                  138 		       ld (hl),a
   0058 23                  139 		       inc hl
   0059 CB 00               140 		       rlc b
   005B DAr54s00            141 		       jp c,KeyboardLoop
   005E F1                  142 		       pop af
   005F C1                  143 		       pop bc
   0060 E1                  144 		       pop hl
                            145 		       
                            146 ;keyboard.c:47: if(KeyboardPollCount>0) {
                            147 ;	genCmpGt
   0061 3E 00               148 	ld	a,#0x00
   0063 FD 21r2As00         149 	ld	iy,#_KeyboardPollCount
   0067 FD 96 00            150 	sub	a,0(iy)
   006A F2r73s00            151 	jp	p,00221$
                            152 ;keyboard.c:48: KeyboardPollCount--;
                            153 ;	genMinus
   006D FD 35 00            154 	dec	0(iy)
                            155 ;	genGoto
   0070 C3r78s02            156 	jp	00223$
                            157 ;	genLabel
   0073                     158 00221$:
                            159 ;keyboard.c:50: Char='\0';
                            160 ;	genAssign
   0073 0E 00               161 	ld	c,#0x00
                            162 ;keyboard.c:51: if(KeyTable[0]&0x02) Char='z';
                            163 ;	genPointerGet
   0075 21r01s00            164 	ld	hl,#_KeyTable
   0078 46                  165 	ld	b,(hl)
                            166 ;	genAnd
   0079 78                  167 	ld	a,b
   007A E6 02               168 	and	a,#0x02
   007C CAr84s00            169 	jp	z,00110$
   007F                     170 00270$:
                            171 ;	genAssign
   007F 0E 7A               172 	ld	c,#0x7A
                            173 ;	genGoto
   0081 C3rA2s00            174 	jp	00111$
                            175 ;	genLabel
   0084                     176 00110$:
                            177 ;keyboard.c:52: else if(KeyTable[0]&0x04) Char='x';
                            178 ;	genAnd
   0084 78                  179 	ld	a,b
   0085 E6 04               180 	and	a,#0x04
   0087 CAr8Fs00            181 	jp	z,00107$
   008A                     182 00271$:
                            183 ;	genAssign
   008A 0E 78               184 	ld	c,#0x78
                            185 ;	genGoto
   008C C3rA2s00            186 	jp	00111$
                            187 ;	genLabel
   008F                     188 00107$:
                            189 ;keyboard.c:53: else if(KeyTable[0]&0x08) Char='c';
                            190 ;	genAnd
   008F 78                  191 	ld	a,b
   0090 E6 08               192 	and	a,#0x08
   0092 CAr9As00            193 	jp	z,00104$
   0095                     194 00272$:
                            195 ;	genAssign
   0095 0E 63               196 	ld	c,#0x63
                            197 ;	genGoto
   0097 C3rA2s00            198 	jp	00111$
                            199 ;	genLabel
   009A                     200 00104$:
                            201 ;keyboard.c:54: else if(KeyTable[0]&0x10) Char='v';
                            202 ;	genAnd
   009A 78                  203 	ld	a,b
   009B E6 10               204 	and	a,#0x10
   009D CArA2s00            205 	jp	z,00111$
   00A0                     206 00273$:
                            207 ;	genAssign
   00A0 0E 76               208 	ld	c,#0x76
                            209 ;	genLabel
   00A2                     210 00111$:
                            211 ;keyboard.c:55: if(KeyTable[1]&0x01) Char='a';
                            212 ;	genPlus
                            213 ;	genPlusIncr
   00A2 21r02s00            214 	ld	hl,#_KeyTable + 1
                            215 ;	genPointerGet
   00A5 5E                  216 	ld	e,(hl)
                            217 ;	genAnd
   00A6 7B                  218 	ld	a,e
   00A7 E6 01               219 	and	a,#0x01
   00A9 CArB1s00            220 	jp	z,00124$
   00AC                     221 00274$:
                            222 ;	genAssign
   00AC 0E 61               223 	ld	c,#0x61
                            224 ;	genGoto
   00AE C3rDAs00            225 	jp	00125$
                            226 ;	genLabel
   00B1                     227 00124$:
                            228 ;keyboard.c:56: else if(KeyTable[1]&0x02) Char='s';
                            229 ;	genAnd
   00B1 7B                  230 	ld	a,e
   00B2 E6 02               231 	and	a,#0x02
   00B4 CArBCs00            232 	jp	z,00121$
   00B7                     233 00275$:
                            234 ;	genAssign
   00B7 0E 73               235 	ld	c,#0x73
                            236 ;	genGoto
   00B9 C3rDAs00            237 	jp	00125$
                            238 ;	genLabel
   00BC                     239 00121$:
                            240 ;keyboard.c:57: else if(KeyTable[1]&0x04) Char='d';
                            241 ;	genAnd
   00BC 7B                  242 	ld	a,e
   00BD E6 04               243 	and	a,#0x04
   00BF CArC7s00            244 	jp	z,00118$
   00C2                     245 00276$:
                            246 ;	genAssign
   00C2 0E 64               247 	ld	c,#0x64
                            248 ;	genGoto
   00C4 C3rDAs00            249 	jp	00125$
                            250 ;	genLabel
   00C7                     251 00118$:
                            252 ;keyboard.c:58: else if(KeyTable[1]&0x08) Char='f';
                            253 ;	genAnd
   00C7 7B                  254 	ld	a,e
   00C8 E6 08               255 	and	a,#0x08
   00CA CArD2s00            256 	jp	z,00115$
   00CD                     257 00277$:
                            258 ;	genAssign
   00CD 0E 66               259 	ld	c,#0x66
                            260 ;	genGoto
   00CF C3rDAs00            261 	jp	00125$
                            262 ;	genLabel
   00D2                     263 00115$:
                            264 ;keyboard.c:59: else if(KeyTable[1]&0x10) Char='g';
                            265 ;	genAnd
   00D2 7B                  266 	ld	a,e
   00D3 E6 10               267 	and	a,#0x10
   00D5 CArDAs00            268 	jp	z,00125$
   00D8                     269 00278$:
                            270 ;	genAssign
   00D8 0E 67               271 	ld	c,#0x67
                            272 ;	genLabel
   00DA                     273 00125$:
                            274 ;keyboard.c:60: if(KeyTable[2]&0x01) Char='q';
                            275 ;	genPlus
                            276 ;	genPlusIncr
   00DA 21r03s00            277 	ld	hl,#_KeyTable + 2
                            278 ;	genPointerGet
   00DD 5E                  279 	ld	e,(hl)
                            280 ;	genAnd
   00DE 7B                  281 	ld	a,e
   00DF E6 01               282 	and	a,#0x01
   00E1 CArE9s00            283 	jp	z,00138$
   00E4                     284 00279$:
                            285 ;	genAssign
   00E4 0E 71               286 	ld	c,#0x71
                            287 ;	genGoto
   00E6 C3r12s01            288 	jp	00139$
                            289 ;	genLabel
   00E9                     290 00138$:
                            291 ;keyboard.c:61: else if(KeyTable[2]&0x02) Char='w';
                            292 ;	genAnd
   00E9 7B                  293 	ld	a,e
   00EA E6 02               294 	and	a,#0x02
   00EC CArF4s00            295 	jp	z,00135$
   00EF                     296 00280$:
                            297 ;	genAssign
   00EF 0E 77               298 	ld	c,#0x77
                            299 ;	genGoto
   00F1 C3r12s01            300 	jp	00139$
                            301 ;	genLabel
   00F4                     302 00135$:
                            303 ;keyboard.c:62: else if(KeyTable[2]&0x04) Char='e';
                            304 ;	genAnd
   00F4 7B                  305 	ld	a,e
   00F5 E6 04               306 	and	a,#0x04
   00F7 CArFFs00            307 	jp	z,00132$
   00FA                     308 00281$:
                            309 ;	genAssign
   00FA 0E 65               310 	ld	c,#0x65
                            311 ;	genGoto
   00FC C3r12s01            312 	jp	00139$
                            313 ;	genLabel
   00FF                     314 00132$:
                            315 ;keyboard.c:63: else if(KeyTable[2]&0x08) Char='r';
                            316 ;	genAnd
   00FF 7B                  317 	ld	a,e
   0100 E6 08               318 	and	a,#0x08
   0102 CAr0As01            319 	jp	z,00129$
   0105                     320 00282$:
                            321 ;	genAssign
   0105 0E 72               322 	ld	c,#0x72
                            323 ;	genGoto
   0107 C3r12s01            324 	jp	00139$
                            325 ;	genLabel
   010A                     326 00129$:
                            327 ;keyboard.c:64: else if(KeyTable[2]&0x10) Char='t';
                            328 ;	genAnd
   010A 7B                  329 	ld	a,e
   010B E6 10               330 	and	a,#0x10
   010D CAr12s01            331 	jp	z,00139$
   0110                     332 00283$:
                            333 ;	genAssign
   0110 0E 74               334 	ld	c,#0x74
                            335 ;	genLabel
   0112                     336 00139$:
                            337 ;keyboard.c:65: if(KeyTable[3]&0x01) Char='1';
                            338 ;	genPlus
                            339 ;	genPlusIncr
   0112 21r04s00            340 	ld	hl,#_KeyTable + 3
                            341 ;	genPointerGet
   0115 5E                  342 	ld	e,(hl)
                            343 ;	genAnd
   0116 7B                  344 	ld	a,e
   0117 E6 01               345 	and	a,#0x01
   0119 CAr21s01            346 	jp	z,00152$
   011C                     347 00284$:
                            348 ;	genAssign
   011C 0E 31               349 	ld	c,#0x31
                            350 ;	genGoto
   011E C3r4As01            351 	jp	00153$
                            352 ;	genLabel
   0121                     353 00152$:
                            354 ;keyboard.c:66: else if(KeyTable[3]&0x02) Char='2';
                            355 ;	genAnd
   0121 7B                  356 	ld	a,e
   0122 E6 02               357 	and	a,#0x02
   0124 CAr2Cs01            358 	jp	z,00149$
   0127                     359 00285$:
                            360 ;	genAssign
   0127 0E 32               361 	ld	c,#0x32
                            362 ;	genGoto
   0129 C3r4As01            363 	jp	00153$
                            364 ;	genLabel
   012C                     365 00149$:
                            366 ;keyboard.c:67: else if(KeyTable[3]&0x04) Char='3';
                            367 ;	genAnd
   012C 7B                  368 	ld	a,e
   012D E6 04               369 	and	a,#0x04
   012F CAr37s01            370 	jp	z,00146$
   0132                     371 00286$:
                            372 ;	genAssign
   0132 0E 33               373 	ld	c,#0x33
                            374 ;	genGoto
   0134 C3r4As01            375 	jp	00153$
                            376 ;	genLabel
   0137                     377 00146$:
                            378 ;keyboard.c:68: else if(KeyTable[3]&0x08) Char='4';
                            379 ;	genAnd
   0137 7B                  380 	ld	a,e
   0138 E6 08               381 	and	a,#0x08
   013A CAr42s01            382 	jp	z,00143$
   013D                     383 00287$:
                            384 ;	genAssign
   013D 0E 34               385 	ld	c,#0x34
                            386 ;	genGoto
   013F C3r4As01            387 	jp	00153$
                            388 ;	genLabel
   0142                     389 00143$:
                            390 ;keyboard.c:69: else if(KeyTable[3]&0x10) Char='5';
                            391 ;	genAnd
   0142 7B                  392 	ld	a,e
   0143 E6 10               393 	and	a,#0x10
   0145 CAr4As01            394 	jp	z,00153$
   0148                     395 00288$:
                            396 ;	genAssign
   0148 0E 35               397 	ld	c,#0x35
                            398 ;	genLabel
   014A                     399 00153$:
                            400 ;keyboard.c:70: if(KeyTable[4]&0x01) Char='0';
                            401 ;	genPlus
                            402 ;	genPlusIncr
   014A 21r05s00            403 	ld	hl,#_KeyTable + 4
                            404 ;	genPointerGet
   014D 5E                  405 	ld	e,(hl)
                            406 ;	genAnd
   014E 7B                  407 	ld	a,e
   014F E6 01               408 	and	a,#0x01
   0151 CAr59s01            409 	jp	z,00166$
   0154                     410 00289$:
                            411 ;	genAssign
   0154 0E 30               412 	ld	c,#0x30
                            413 ;	genGoto
   0156 C3r82s01            414 	jp	00167$
                            415 ;	genLabel
   0159                     416 00166$:
                            417 ;keyboard.c:71: else if(KeyTable[4]&0x02) Char='9';
                            418 ;	genAnd
   0159 7B                  419 	ld	a,e
   015A E6 02               420 	and	a,#0x02
   015C CAr64s01            421 	jp	z,00163$
   015F                     422 00290$:
                            423 ;	genAssign
   015F 0E 39               424 	ld	c,#0x39
                            425 ;	genGoto
   0161 C3r82s01            426 	jp	00167$
                            427 ;	genLabel
   0164                     428 00163$:
                            429 ;keyboard.c:72: else if(KeyTable[4]&0x04) Char='8';
                            430 ;	genAnd
   0164 7B                  431 	ld	a,e
   0165 E6 04               432 	and	a,#0x04
   0167 CAr6Fs01            433 	jp	z,00160$
   016A                     434 00291$:
                            435 ;	genAssign
   016A 0E 38               436 	ld	c,#0x38
                            437 ;	genGoto
   016C C3r82s01            438 	jp	00167$
                            439 ;	genLabel
   016F                     440 00160$:
                            441 ;keyboard.c:73: else if(KeyTable[4]&0x08) Char='7';
                            442 ;	genAnd
   016F 7B                  443 	ld	a,e
   0170 E6 08               444 	and	a,#0x08
   0172 CAr7As01            445 	jp	z,00157$
   0175                     446 00292$:
                            447 ;	genAssign
   0175 0E 37               448 	ld	c,#0x37
                            449 ;	genGoto
   0177 C3r82s01            450 	jp	00167$
                            451 ;	genLabel
   017A                     452 00157$:
                            453 ;keyboard.c:74: else if(KeyTable[4]&0x10) Char='6';
                            454 ;	genAnd
   017A 7B                  455 	ld	a,e
   017B E6 10               456 	and	a,#0x10
   017D CAr82s01            457 	jp	z,00167$
   0180                     458 00293$:
                            459 ;	genAssign
   0180 0E 36               460 	ld	c,#0x36
                            461 ;	genLabel
   0182                     462 00167$:
                            463 ;keyboard.c:75: if(KeyTable[5]&0x01) Char='p';
                            464 ;	genPlus
                            465 ;	genPlusIncr
   0182 21r06s00            466 	ld	hl,#_KeyTable + 5
                            467 ;	genPointerGet
   0185 5E                  468 	ld	e,(hl)
                            469 ;	genAnd
   0186 7B                  470 	ld	a,e
   0187 E6 01               471 	and	a,#0x01
   0189 CAr91s01            472 	jp	z,00180$
   018C                     473 00294$:
                            474 ;	genAssign
   018C 0E 70               475 	ld	c,#0x70
                            476 ;	genGoto
   018E C3rBAs01            477 	jp	00181$
                            478 ;	genLabel
   0191                     479 00180$:
                            480 ;keyboard.c:76: else if(KeyTable[5]&0x02) Char='o';
                            481 ;	genAnd
   0191 7B                  482 	ld	a,e
   0192 E6 02               483 	and	a,#0x02
   0194 CAr9Cs01            484 	jp	z,00177$
   0197                     485 00295$:
                            486 ;	genAssign
   0197 0E 6F               487 	ld	c,#0x6F
                            488 ;	genGoto
   0199 C3rBAs01            489 	jp	00181$
                            490 ;	genLabel
   019C                     491 00177$:
                            492 ;keyboard.c:77: else if(KeyTable[5]&0x04) Char='i';
                            493 ;	genAnd
   019C 7B                  494 	ld	a,e
   019D E6 04               495 	and	a,#0x04
   019F CArA7s01            496 	jp	z,00174$
   01A2                     497 00296$:
                            498 ;	genAssign
   01A2 0E 69               499 	ld	c,#0x69
                            500 ;	genGoto
   01A4 C3rBAs01            501 	jp	00181$
                            502 ;	genLabel
   01A7                     503 00174$:
                            504 ;keyboard.c:78: else if(KeyTable[5]&0x08) Char='u';
                            505 ;	genAnd
   01A7 7B                  506 	ld	a,e
   01A8 E6 08               507 	and	a,#0x08
   01AA CArB2s01            508 	jp	z,00171$
   01AD                     509 00297$:
                            510 ;	genAssign
   01AD 0E 75               511 	ld	c,#0x75
                            512 ;	genGoto
   01AF C3rBAs01            513 	jp	00181$
                            514 ;	genLabel
   01B2                     515 00171$:
                            516 ;keyboard.c:79: else if(KeyTable[5]&0x10) Char='y';
                            517 ;	genAnd
   01B2 7B                  518 	ld	a,e
   01B3 E6 10               519 	and	a,#0x10
   01B5 CArBAs01            520 	jp	z,00181$
   01B8                     521 00298$:
                            522 ;	genAssign
   01B8 0E 79               523 	ld	c,#0x79
                            524 ;	genLabel
   01BA                     525 00181$:
                            526 ;keyboard.c:80: if(KeyTable[6]&0x01) Char='\n';
                            527 ;	genPlus
                            528 ;	genPlusIncr
   01BA 21r07s00            529 	ld	hl,#_KeyTable + 6
                            530 ;	genPointerGet
   01BD 5E                  531 	ld	e,(hl)
                            532 ;	genAnd
   01BE 7B                  533 	ld	a,e
   01BF E6 01               534 	and	a,#0x01
   01C1 CArC9s01            535 	jp	z,00194$
   01C4                     536 00299$:
                            537 ;	genAssign
   01C4 0E 0A               538 	ld	c,#0x0A
                            539 ;	genGoto
   01C6 C3rF2s01            540 	jp	00195$
                            541 ;	genLabel
   01C9                     542 00194$:
                            543 ;keyboard.c:81: else if(KeyTable[6]&0x02) Char='l';
                            544 ;	genAnd
   01C9 7B                  545 	ld	a,e
   01CA E6 02               546 	and	a,#0x02
   01CC CArD4s01            547 	jp	z,00191$
   01CF                     548 00300$:
                            549 ;	genAssign
   01CF 0E 6C               550 	ld	c,#0x6C
                            551 ;	genGoto
   01D1 C3rF2s01            552 	jp	00195$
                            553 ;	genLabel
   01D4                     554 00191$:
                            555 ;keyboard.c:82: else if(KeyTable[6]&0x04) Char='k';
                            556 ;	genAnd
   01D4 7B                  557 	ld	a,e
   01D5 E6 04               558 	and	a,#0x04
   01D7 CArDFs01            559 	jp	z,00188$
   01DA                     560 00301$:
                            561 ;	genAssign
   01DA 0E 6B               562 	ld	c,#0x6B
                            563 ;	genGoto
   01DC C3rF2s01            564 	jp	00195$
                            565 ;	genLabel
   01DF                     566 00188$:
                            567 ;keyboard.c:83: else if(KeyTable[6]&0x08) Char='j';
                            568 ;	genAnd
   01DF 7B                  569 	ld	a,e
   01E0 E6 08               570 	and	a,#0x08
   01E2 CArEAs01            571 	jp	z,00185$
   01E5                     572 00302$:
                            573 ;	genAssign
   01E5 0E 6A               574 	ld	c,#0x6A
                            575 ;	genGoto
   01E7 C3rF2s01            576 	jp	00195$
                            577 ;	genLabel
   01EA                     578 00185$:
                            579 ;keyboard.c:84: else if(KeyTable[6]&0x10) Char='h';
                            580 ;	genAnd
   01EA 7B                  581 	ld	a,e
   01EB E6 10               582 	and	a,#0x10
   01ED CArF2s01            583 	jp	z,00195$
   01F0                     584 00303$:
                            585 ;	genAssign
   01F0 0E 68               586 	ld	c,#0x68
                            587 ;	genLabel
   01F2                     588 00195$:
                            589 ;keyboard.c:85: if(KeyTable[7]&0x01) Char=' ';
                            590 ;	genPlus
                            591 ;	genPlusIncr
   01F2 21r08s00            592 	ld	hl,#_KeyTable + 7
                            593 ;	genPointerGet
   01F5 5E                  594 	ld	e,(hl)
                            595 ;	genAnd
   01F6 7B                  596 	ld	a,e
   01F7 E6 01               597 	and	a,#0x01
   01F9 CAr01s02            598 	jp	z,00208$
   01FC                     599 00304$:
                            600 ;	genAssign
   01FC 0E 20               601 	ld	c,#0x20
                            602 ;	genGoto
   01FE C3r2As02            603 	jp	00209$
                            604 ;	genLabel
   0201                     605 00208$:
                            606 ;keyboard.c:86: else if(KeyTable[7]&0x02) Char=' ';
                            607 ;	genAnd
   0201 7B                  608 	ld	a,e
   0202 E6 02               609 	and	a,#0x02
   0204 CAr0Cs02            610 	jp	z,00205$
   0207                     611 00305$:
                            612 ;	genAssign
   0207 0E 20               613 	ld	c,#0x20
                            614 ;	genGoto
   0209 C3r2As02            615 	jp	00209$
                            616 ;	genLabel
   020C                     617 00205$:
                            618 ;keyboard.c:87: else if(KeyTable[7]&0x04) Char='m';
                            619 ;	genAnd
   020C 7B                  620 	ld	a,e
   020D E6 04               621 	and	a,#0x04
   020F CAr17s02            622 	jp	z,00202$
   0212                     623 00306$:
                            624 ;	genAssign
   0212 0E 6D               625 	ld	c,#0x6D
                            626 ;	genGoto
   0214 C3r2As02            627 	jp	00209$
                            628 ;	genLabel
   0217                     629 00202$:
                            630 ;keyboard.c:88: else if(KeyTable[7]&0x08) Char='n';
                            631 ;	genAnd
   0217 7B                  632 	ld	a,e
   0218 E6 08               633 	and	a,#0x08
   021A CAr22s02            634 	jp	z,00199$
   021D                     635 00307$:
                            636 ;	genAssign
   021D 0E 6E               637 	ld	c,#0x6E
                            638 ;	genGoto
   021F C3r2As02            639 	jp	00209$
                            640 ;	genLabel
   0222                     641 00199$:
                            642 ;keyboard.c:89: else if(KeyTable[7]&0x10) Char='b';
                            643 ;	genAnd
   0222 7B                  644 	ld	a,e
   0223 E6 10               645 	and	a,#0x10
   0225 CAr2As02            646 	jp	z,00209$
   0228                     647 00308$:
                            648 ;	genAssign
   0228 0E 62               649 	ld	c,#0x62
                            650 ;	genLabel
   022A                     651 00209$:
                            652 ;keyboard.c:90: if(Char>='a' && Char<='z') if(KeyTable[0]&0x01) Char=Char+('A'-'a');
                            653 ;	genAssign
   022A 69                  654 	ld	l,c
                            655 ;	genCmpLt
   022B 7D                  656 	ld	a,l
   022C D6 61               657 	sub	a,#0x61
   022E DAr42s02            658 	jp	c,00213$
                            659 ;	genAssign
   0231 69                  660 	ld	l,c
                            661 ;	genCmpGt
   0232 3E 7A               662 	ld	a,#0x7A
   0234 95                  663 	sub	a,l
   0235 DAr42s02            664 	jp	c,00213$
                            665 ;	genAnd
   0238 78                  666 	ld	a,b
   0239 E6 01               667 	and	a,#0x01
   023B CAr42s02            668 	jp	z,00213$
   023E                     669 00309$:
                            670 ;	genPlus
                            671 ;	genPlusIncr
                            672 ;	Can't optimise plus by inc, falling back to the normal way
   023E 79                  673 	ld	a,c
   023F C6 E0               674 	add	a,#0xE0
   0241 4F                  675 	ld	c,a
                            676 ;	genLabel
   0242                     677 00213$:
                            678 ;keyboard.c:91: if(Char!='\0') {
                            679 ;	genCmpEq
                            680 ; genCmpEq: left 1, right 1, result 0
   0242 79                  681 	ld	a,c
   0243 B7                  682 	or	a,a
   0244 CAr78s02            683 	jp	z,00223$
   0247                     684 00310$:
                            685 ;keyboard.c:92: if(KeyboardBufferCount>=MAX_KEYBOARDBUFFER) Beep(); else {
                            686 ;	genCmpLt
   0247 FD 21r29s00         687 	ld	iy,#_KeyboardBufferCount
   024B FD 7E 00            688 	ld	a,0(iy)
   024E D6 20               689 	sub	a,#0x20
   0250 FAr5Bs02            690 	jp	m,00216$
                            691 ;	genCall
                            692 ; _saveRegsForCall: sendSetSize: 0 deInUse: 0 bcInUse: 1 deSending: 0
   0253 C5                  693 	push	bc
   0254 CDr00s00            694 	call	_Beep
   0257 C1                  695 	pop	bc
                            696 ;	genGoto
   0258 C3r78s02            697 	jp	00223$
                            698 ;	genLabel
   025B                     699 00216$:
                            700 ;keyboard.c:93: KeyboardBuffer[KeyboardBufferCount]=Char;
                            701 ;	genPlus
                            702 ;	Can't optimise plus by inc, falling back to the normal way
                            703 ;	Shift into pair idx 0
   025B 21r29s00            704 	ld	hl,#_KeyboardBufferCount
   025E 3Er09               705 	ld	a,#<_KeyboardBuffer
   0260 86                  706 	add	a,(hl)
   0261 5F                  707 	ld	e,a
   0262 3Es00               708 	ld	a,#>_KeyboardBuffer
   0264 CE 00               709 	adc	a,#0x00
   0266 57                  710 	ld	d,a
                            711 ;	genAssign (pointer)
                            712 ;	isBitvar = 0
   0267 79                  713 	ld	a,c
   0268 12                  714 	ld	(de),a
                            715 ;keyboard.c:94: KeyboardBufferCount++;
                            716 ;	genPlus
                            717 ;	genPlusIncr
   0269 FD 21r29s00         718 	ld	iy,#_KeyboardBufferCount
   026D FD 34 00            719 	inc	0(iy)
                            720 ;keyboard.c:95: KeyboardPollCount=6;
                            721 ;	genAssign
   0270 FD 21r2As00         722 	ld	iy,#_KeyboardPollCount
   0274 FD 36 00 06         723 	ld	0(iy),#0x06
                            724 ;	genLabel
   0278                     725 00223$:
                            726 ;	genEndFunction
   0278 3E 04               727 	ld	a,#4
   027A CF                  728 	rst	0x08
   027B C9                  729 	ret
   027C                     730 _PollKeyboard_end::
                            731 ;keyboard.c:101: char GetKeypress() {
                            732 ;	genLabel
                            733 ;	genFunction
                            734 ;	---------------------------------
                            735 ; Function GetKeypress
                            736 ; ---------------------------------
   027C                     737 _GetKeypress_start::
   027C                     738 _GetKeypress:
   027C 3E 03               739 	ld	a,#3
   027E CF                  740 	rst	0x08
                            741 ;keyboard.c:104: Pause();
                            742 ;	genCall
                            743 ; _saveRegsForCall: sendSetSize: 0 deInUse: 0 bcInUse: 0 deSending: 0
   027F CDr00s00            744 	call	_Pause
                            745 ;keyboard.c:105: if(KeyboardBufferCount) {
                            746 ;	genIfx
   0282 AF                  747 	xor	a,a
   0283 FD 21r29s00         748 	ld	iy,#_KeyboardBufferCount
   0287 FD B6 00            749 	or	a,0(iy)
   028A CArC5s02            750 	jp	z,00102$
                            751 ;keyboard.c:106: Keypress=KeyboardBuffer[0];
                            752 ;	genPointerGet
   028D 21r09s00            753 	ld	hl,#_KeyboardBuffer
   0290 6E                  754 	ld	l,(hl)
                            755 ;	genAssign
   0291 4D                  756 	ld	c,l
                            757 ;keyboard.c:107: for(i=1; i<KeyboardBufferCount; i++) KeyboardBuffer[i-1]=KeyboardBuffer[i];
                            758 ;	genAssign
   0292 06 01               759 	ld	b,#0x01
                            760 ;	genLabel
   0294                     761 00104$:
                            762 ;	genCmpLt
   0294 78                  763 	ld	a,b
   0295 FD 21r29s00         764 	ld	iy,#_KeyboardBufferCount
   0299 FD 96 00            765 	sub	a,0(iy)
   029C F2rBBs02            766 	jp	p,00107$
                            767 ;	genMinus
   029F 78                  768 	ld	a,b
   02A0 C6 FF               769 	add	a,#0xFF
   02A2 6F                  770 	ld	l,a
                            771 ;	genPlus
                            772 ;	Can't optimise plus by inc, falling back to the normal way
   02A3 3Er09               773 	ld	a,#<_KeyboardBuffer
   02A5 85                  774 	add	a,l
   02A6 5F                  775 	ld	e,a
   02A7 3Es00               776 	ld	a,#>_KeyboardBuffer
   02A9 CE 00               777 	adc	a,#0x00
   02AB 57                  778 	ld	d,a
                            779 ;	genPlus
                            780 ;	Can't optimise plus by inc, falling back to the normal way
   02AC 3Er09               781 	ld	a,#<_KeyboardBuffer
   02AE 80                  782 	add	a,b
   02AF 6F                  783 	ld	l,a
   02B0 3Es00               784 	ld	a,#>_KeyboardBuffer
   02B2 CE 00               785 	adc	a,#0x00
   02B4 67                  786 	ld	h,a
                            787 ;	genPointerGet
   02B5 7E                  788 	ld	a,(hl)
                            789 ;	genAssign (pointer)
                            790 ;	isBitvar = 0
   02B6 12                  791 	ld	(de),a
                            792 ;	genPlus
                            793 ;	genPlusIncr
                            794 ; Removed redundent load
   02B7 04                  795 	inc	b
                            796 ;	genGoto
   02B8 C3r94s02            797 	jp	00104$
                            798 ;	genLabel
   02BB                     799 00107$:
                            800 ;keyboard.c:108: KeyboardBufferCount--;
                            801 ;	genMinus
   02BB FD 21r29s00         802 	ld	iy,#_KeyboardBufferCount
   02BF FD 35 00            803 	dec	0(iy)
                            804 ;	genGoto
   02C2 C3rC7s02            805 	jp	00103$
                            806 ;	genLabel
   02C5                     807 00102$:
                            808 ;keyboard.c:110: Keypress='\0';
                            809 ;	genAssign
   02C5 0E 00               810 	ld	c,#0x00
                            811 ;	genLabel
   02C7                     812 00103$:
                            813 ;keyboard.c:112: Resume();
                            814 ;	genCall
                            815 ; _saveRegsForCall: sendSetSize: 0 deInUse: 0 bcInUse: 1 deSending: 0
   02C7 C5                  816 	push	bc
   02C8 CDr00s00            817 	call	_Resume
   02CB C1                  818 	pop	bc
                            819 ;keyboard.c:113: return Keypress;
                            820 ;	genRet
                            821 ; Dump of IC_LEFT: type AOP_REG size 1
                            822 ;	 reg = c
   02CC 69                  823 	ld	l,c
                            824 ;	genLabel
   02CD                     825 00108$:
                            826 ;	genEndFunction
   02CD 3E 04               827 	ld	a,#4
   02CF CF                  828 	rst	0x08
   02D0 C9                  829 	ret
   02D1                     830 _GetKeypress_end::
                            831 	.area _CODE
